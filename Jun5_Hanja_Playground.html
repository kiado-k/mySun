<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì¤€5ê¸‰ í•œì ë†€ì´í„° (ìµœì¢… ì™„ì„±)</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f0fdf4;
            user-select: none;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }
        .font-jua {
            font-family: 'Jua', sans-serif;
        }
        
        .perspective-1000 { perspective: 1000px; }
        .card-inner { transition: transform 0.6s; transform-style: preserve-3d; }
        .flipped .card-inner { transform: rotateY(180deg); }
        .card-front, .card-back {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
        }
        .card-back { transform: rotateY(180deg); }

        .pop-animation { animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        .shake-animation { animation: shake 0.5s; }
        @keyframes shake {
            0% { transform: translateX(0); } 25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ------------------------------------------------
        // ë°ì´í„°
        // ------------------------------------------------
        const hanjaData = [
            { id: 1, hanja: "å®¶æ—", hangul: "ê°€ì¡±", meaning: "í•œ ì§‘ì•ˆ ì‹êµ¬" },
            { id: 2, hanja: "è§’", hangul: "ê°", meaning: "ë¿”, ëª¨ì„œë¦¬" },
            { id: 3, hanja: "æ„Ÿæƒ³", hangul: "ê°ìƒ", meaning: "ë§ˆìŒì†ì˜ ìƒê°" },
            { id: 4, hanja: "ç¶“æ¿Ÿ", hangul: "ê²½ì œ", meaning: "ëˆì„ ë²Œê³  ì“°ëŠ” í™œë™" },
            { id: 5, hanja: "å›ºé«”", hangul: "ê³ ì²´", meaning: "ë‹¨ë‹¨í•œ ëª¨ì–‘ì˜ ë¬¼ì²´" },
            { id: 6, hanja: "å…¬å…±", hangul: "ê³µê³µ", meaning: "ì—¬ëŸ¬ ì‚¬ëŒ, ì‚¬íšŒ ì „ì²´" },
            { id: 7, hanja: "è§€å…‰å®¢", hangul: "ê´€ê´‘ê°", meaning: "ë†€ëŸ¬ ì˜¨ ì†ë‹˜" },
            { id: 8, hanja: "è§€å¯Ÿ", hangul: "ê´€ì°°", meaning: "ìì„¸íˆ ì‚´í´ë´„" },
            { id: 9, hanja: "æ±‚æ„›è¡Œå‹•", hangul: "êµ¬ì• í–‰ë™", meaning: "ì§ì„ ì°¾ëŠ” ëª¸ì§“" },
            { id: 10, hanja: "åœ‹å¯¶", hangul: "êµ­ë³´", meaning: "ë‚˜ë¼ì˜ ë³´ë¬¼" },
            { id: 11, hanja: "è¨˜äº‹", hangul: "ê¸°ì‚¬", meaning: "ì‹ ë¬¸ì´ë‚˜ ì¡ì§€ì˜ ê¸€" },
            { id: 12, hanja: "è¾²æ‘", hangul: "ë†ì´Œ", meaning: "ë†ì‚¬ ì§“ëŠ” ë§ˆì„" },
            { id: 13, hanja: "è¸æŸ»", hangul: "ë‹µì‚¬", meaning: "í˜„ì¥ì— ê°€ì„œ ì¡°ì‚¬í•¨" },
            { id: 14, hanja: "å¸¶åˆ†æ•¸", hangul: "ëŒ€ë¶„ìˆ˜", meaning: "ìì—°ìˆ˜ì™€ ì§„ë¶„ìˆ˜ì˜ í•©" },
            { id: 15, hanja: "å°ç…§", hangul: "ëŒ€ì¡°", meaning: "ì„œë¡œ ë¹„êµí•¨" },
            { id: 16, hanja: "éƒ½å¸‚", hangul: "ë„ì‹œ", meaning: "ì‚¬ëŒì´ ë§ì€ ì§€ì—­" },
            { id: 17, hanja: "ç­‰é«˜ç·š", hangul: "ë“±ê³ ì„ ", meaning: "ë†’ì´ê°€ ê°™ì€ ì§€ì ì˜ ì„ " },
            { id: 18, hanja: "æ–‡æ®µ", hangul: "ë¬¸ë‹¨", meaning: "ê¸€ì˜ í•œ ë©ì–´ë¦¬" },
            { id: 19, hanja: "æ–‡åŒ–è²¡", hangul: "ë¬¸í™”ì¬", meaning: "ë¬¸í™”ì  ê°€ì¹˜ê°€ ìˆëŠ” ê²ƒ" },
            { id: 20, hanja: "åšè¦½æœƒ", hangul: "ë°•ëŒíšŒ", meaning: "ë¬¼ê±´ì„ ë²Œì—¬ë†“ê³  êµ¬ê²½ì‹œí‚´" },
            { id: 21, hanja: "åšç‰©é¤¨", hangul: "ë°•ë¬¼ê´€", meaning: "ìœ ë¬¼ì„ ì „ì‹œí•˜ëŠ” ê³³" },
            { id: 22, hanja: "åçœ", hangul: "ë°˜ì„±", meaning: "ì˜ëª»ì„ ë‰˜ìš°ì¹¨" },
            { id: 23, hanja: "ä¸å°é«”", hangul: "ë¶€ë„ì²´", meaning: "ì „ê¸°ê°€ ì•ˆ í†µí•˜ëŠ” ë¬¼ì²´" },
            { id: 24, hanja: "åˆ†éŠ…", hangul: "ë¶„ë™", meaning: "ë¬´ê²Œë¥¼ ì¬ëŠ” ì¶”" },
            { id: 25, hanja: "æƒ³åƒ", hangul: "ìƒìƒ", meaning: "ë¯¸ë£¨ì–´ ìƒê°í•¨" },
            { id: 26, hanja: "é¸æ“‡", hangul: "ì„ íƒ", meaning: "ê³¨ë¼ ë½‘ìŒ" },
            { id: 27, hanja: "æ‰€å¾—", hangul: "ì†Œë“", meaning: "ì–»ì€ ìˆ˜ì…" },
            { id: 28, hanja: "ç´ æ", hangul: "ì†Œì¬", meaning: "ë§Œë“œëŠ” ì¬ë£Œ" },
            { id: 29, hanja: "ä¿—è«‡", hangul: "ì†ë‹´", meaning: "ì˜ˆë¡œë¶€í„° ì „í•´ì˜¤ëŠ” ë§" },
            { id: 30, hanja: "è©©", hangul: "ì‹œ", meaning: "ë§ˆìŒì„ ë…¸ë˜í•œ ê¸€" },
            { id: 31, hanja: "å¯¦è¸", hangul: "ì‹¤ì²œ", meaning: "ìƒê°í•œ ê²ƒì„ í–‰ë™í•¨" },
            { id: 32, hanja: "æ¶²é«”", hangul: "ì•¡ì²´", meaning: "ë¬¼ ê°™ì€ ìƒíƒœ" },
            { id: 33, hanja: "ç´„æŸ", hangul: "ì•½ì†", meaning: "ë¯¸ë˜ì˜ ì¼ì„ ì •í•¨" },
            { id: 34, hanja: "è®“æ­¥", hangul: "ì–‘ë³´", meaning: "ë‚¨ì„ ìœ„í•´ ë¬¼ëŸ¬ì„¬" },
            { id: 35, hanja: "æ­·å²", hangul: "ì—­ì‚¬", meaning: "ì¸ë¥˜ì˜ ì§€ë‚œ ìì·¨" },
            { id: 36, hanja: "è¯æƒ³", hangul: "ì—°ìƒ", meaning: "ê´€ë ¨ëœ ê²ƒì„ ë– ì˜¬ë¦¼" },
            { id: 37, hanja: "å¹´è¡¨", hangul: "ì—°í‘œ", meaning: "ì—­ì‚¬ë¥¼ í‘œë¡œ ì •ë¦¬í•¨" },
            { id: 38, hanja: "é é‡‘", hangul: "ì˜ˆê¸ˆ", meaning: "ì€í–‰ì— ëˆì„ ë§¡ê¹€" },
            { id: 39, hanja: "ç¦®ç¯€", hangul: "ì˜ˆì ˆ", meaning: "ì˜ˆì˜ë°”ë¥¸ íƒœë„" },
            { id: 40, hanja: "æµé€š", hangul: "ìœ í†µ", meaning: "ë¬¼ê±´ì´ ì˜¤ê³  ê°" },
            { id: 41, hanja: "éŠ€è¡Œ", hangul: "ì€í–‰", meaning: "ëˆì„ ë‹¤ë£¨ëŠ” ê¸°ê´€" },
            { id: 42, hanja: "éŸ³æ¨‚", hangul: "ìŒì•…", meaning: "ì†Œë¦¬ë¡œ ë‚˜íƒ€ë‚´ëŠ” ì˜ˆìˆ " },
            { id: 43, hanja: "è³‡æ–™", hangul: "ìë£Œ", meaning: "ì—°êµ¬ì˜ ë°”íƒ•" },
            { id: 44, hanja: "é›»æ± ", hangul: "ì „ì§€", meaning: "ì „ê¸°ë¥¼ ë‚´ëŠ” ì¥ì¹˜" },
            { id: 45, hanja: "ä¸»é¡Œ", hangul: "ì£¼ì œ", meaning: "ì¤‘ì‹¬ì´ ë˜ëŠ” ë‚´ìš©" },
            { id: 46, hanja: "åœ°åœ–", hangul: "ì§€ë„", meaning: "ë•…ì˜ ëª¨ì–‘ì„ ê·¸ë¦° ê·¸ë¦¼" },
            { id: 47, hanja: "æ”¯å‡º", hangul: "ì§€ì¶œ", meaning: "ëˆì„ ì”€" },
            { id: 48, hanja: "åœ°å±¤", hangul: "ì§€ì¸µ", meaning: "ë•…ì† í™ì˜ ì¸µ" },
            { id: 49, hanja: "ç§©åº", hangul: "ì§ˆì„œ", meaning: "ìˆœì„œì™€ ê·œì¹™" },
            { id: 50, hanja: "é«”æ“", hangul: "ì²´ì¡°", meaning: "ì‹ ì²´ ë‹¨ë ¨ ìš´ë™" },
            { id: 51, hanja: "ç¸®å°º", hangul: "ì¶•ì²™", meaning: "ì§€ë„ì˜ ì¤„ì¸ ë¹„ìœ¨" },
            { id: 52, hanja: "è¨è«–", hangul: "í† ë¡ ", meaning: "ì„œë¡œ ì˜ê²¬ì„ ë‚˜ëˆ”" },
            { id: 53, hanja: "å †ç©", hangul: "í‡´ì ", meaning: "ìŒ“ì´ëŠ” ê²ƒ" },
            { id: 54, hanja: "æŠ•ç¥¨", hangul: "íˆ¬í‘œ", meaning: "í‘œë¥¼ ë˜ì ¸ ê²°ì •í•¨" },
            { id: 55, hanja: "è²©è³£", hangul: "íŒë§¤", meaning: "ë¬¼ê±´ì„ íŒ–" },
            { id: 56, hanja: "åè¦‹", hangul: "í¸ê²¬", meaning: "ì¹˜ìš°ì¹œ ìƒê°" },
            { id: 57, hanja: "ä¾¿ç´™", hangul: "í¸ì§€", meaning: "ì•ˆë¶€ë¥¼ ì „í•˜ëŠ” ê¸€" },
            { id: 58, hanja: "éŸ“åŠå³¶", hangul: "í•œë°˜ë„", meaning: "ìš°ë¦¬ë‚˜ë¼ ë•…" },
            { id: 59, hanja: "å¹¸ç¦", hangul: "í–‰ë³µ", meaning: "ì¦ê²ê³  ë§Œì¡±í•¨" },
            { id: 60, hanja: "åŒ–çŸ³", hangul: "í™”ì„", meaning: "ì˜› ìƒë¬¼ì˜ í”ì " },
            { id: 61, hanja: "å’ŒéŸ³", hangul: "í™”ìŒ", meaning: "ì–´ìš¸ë¦¬ëŠ” ì†Œë¦¬" },
            { id: 62, hanja: "è©±é¡Œ", hangul: "í™”ì œ", meaning: "ì´ì•¼ê¹ƒê±°ë¦¬" }
        ];

        // ------------------------------------------------
        // ì˜¤ë””ì˜¤ ì‹œìŠ¤í…œ (ìƒì¾Œí•œ íš¨ê³¼ìŒ + ë³¼ë¥¨ ë°¸ëŸ°ìŠ¤ ì¡°ì •)
        // ------------------------------------------------
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let globalAudioCtx = null;

        const initAudio = () => {
            if (!globalAudioCtx) globalAudioCtx = new AudioContext();
            if (globalAudioCtx.state === 'suspended') globalAudioCtx.resume();
            return globalAudioCtx;
        };

        const SoundManager = {
            playFreshTone: (freq, type, duration, vol = 0.4) => {
                const ctx = initAudio();
                if (!ctx) return;
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                
                osc.type = type; 
                osc.frequency.setValueAtTime(freq, ctx.currentTime);
                
                gain.gain.setValueAtTime(0, ctx.currentTime);
                gain.gain.linearRampToValueAtTime(vol, ctx.currentTime + 0.02);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);

                osc.connect(gain);
                gain.connect(ctx.destination);
                
                osc.start();
                osc.stop(ctx.currentTime + duration);
            },
            
            click: () => {
                SoundManager.playFreshTone(880, 'sine', 0.1, 0.4); 
            },
            
            flip: () => {
                const ctx = initAudio();
                if(!ctx) return;
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.1);
                
                gain.gain.setValueAtTime(0, ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0.2, ctx.currentTime + 0.02);
                gain.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.15);
                
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start();
                osc.stop(ctx.currentTime + 0.2);
            },
            
            correct: () => {
                [1318.51, 1760.00, 2217.46].forEach((freq, i) => {
                    setTimeout(() => SoundManager.playFreshTone(freq, 'sine', 0.5, 0.4), i * 80);
                });
            },
            
            wrong: () => {
                const ctx = initAudio();
                if(!ctx) return;
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(300, ctx.currentTime);
                osc.frequency.linearRampToValueAtTime(200, ctx.currentTime + 0.3);
                
                gain.gain.setValueAtTime(0, ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0.3, ctx.currentTime + 0.05);
                gain.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.3);
                
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start();
                osc.stop(ctx.currentTime + 0.35);
            },
            
            win: () => {
                const melody = [1318, 1318, 1318, 1760, 2217];
                melody.forEach((freq, i) => {
                    const dur = i === melody.length - 1 ? 0.8 : 0.2;
                    setTimeout(() => SoundManager.playFreshTone(freq, 'sine', dur, 0.5), i * 150);
                });
            }
        };

        // ------------------------------------------------
        // ìœ í‹¸ë¦¬í‹°
        // ------------------------------------------------
        const shuffle = (array) => {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        };

        const formatTime = (seconds) => {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}ë¶„ ${secs < 10 ? '0' : ''}${secs}ì´ˆ`;
        };

        const getHanjaFontSize = (text) => {
            const len = text ? text.length : 0;
            if (len <= 2) return 'text-6xl sm:text-7xl md:text-8xl'; 
            if (len === 3) return 'text-5xl sm:text-6xl md:text-7xl'; 
            if (len === 4) return 'text-4xl sm:text-5xl md:text-6xl'; 
            return 'text-3xl sm:text-4xl md:text-5xl'; 
        };

        const getListHanjaSize = (text) => {
             const len = text ? text.length : 0;
             if (len <= 2) return 'text-4xl';
             if (len === 3) return 'text-3xl';
             return 'text-2xl';
        };

        // ------------------------------------------------
        // BGM í”Œë ˆì´ì–´ (í™”ë©´ ìš°ì¸¡ ìƒë‹¨ ê³ ì • & ë©”ì¸ ë©”ë‰´ì—ì„œë§Œ í‘œì‹œ)
        // ------------------------------------------------
        const BGMPlayer = ({ mode }) => {
            const [isPlaying, setIsPlaying] = useState(false);
            const audioRef = useRef(null);
            
            const BGM_URL = "./suno_bgm.mp3"; 

            useEffect(() => {
                const audio = new Audio(BGM_URL);
                audio.loop = true;
                audio.volume = 0.2; // ë°°ê²½ìŒì•…ì€ ì•„ì£¼ ì‘ê²Œ
                audio.preload = "auto";
                
                audioRef.current = audio;

                return () => {
                    if(audioRef.current) {
                        audioRef.current.pause();
                        audioRef.current = null;
                    }
                };
            }, []);

            const toggleBGM = () => {
                if (!audioRef.current) return;
                initAudio();

                if (isPlaying) {
                    audioRef.current.pause();
                } else {
                    const playPromise = audioRef.current.play();
                    if (playPromise !== undefined) {
                        playPromise.catch(error => {
                            console.log("BGM ì¬ìƒ ì°¨ë‹¨ë¨");
                        });
                    }
                }
                setIsPlaying(!isPlaying);
            };

            // ë©”ì¸ ë©”ë‰´(menu)ê°€ ì•„ë‹ ë•ŒëŠ” ë²„íŠ¼ì„ ë Œë”ë§í•˜ì§€ ì•ŠìŒ (ìŒì•…ì€ ê³„ì† ì¬ìƒë¨)
            if (mode !== 'menu') return null;

            return (
                <div className="fixed top-4 right-4 z-50">
                    <button 
                        onClick={toggleBGM}
                        className={`px-4 py-2 rounded-full shadow-xl transition-all transform hover:scale-105 active:scale-95 flex items-center gap-2 border-2 border-white
                            ${isPlaying ? 'bg-green-500 text-white' : 'bg-gray-400 text-gray-100'}`}
                        title={isPlaying ? "ìŒì•… ë„ê¸°" : "ìŒì•… ì¼œê¸°"}
                    >
                        <span className="text-xl">{isPlaying ? "ğŸ”Š" : "ğŸ”‡"}</span>
                        <span className="font-jua text-sm hidden sm:inline">{isPlaying ? "BGM ON" : "BGM OFF"}</span>
                    </button>
                </div>
            );
        };

        // ------------------------------------------------
        // ë©”ì¸ ë©”ë‰´ (ì €ì‘ê¶Œ í‘œì‹œ ì¶”ê°€ë¨)
        // ------------------------------------------------
        const MainMenu = ({ setMode }) => {
            const handleModeChange = (mode) => {
                SoundManager.click();
                setMode(mode);
            };

            return (
                <div className="flex flex-col items-center justify-center min-h-screen bg-green-50 p-4 relative overflow-hidden" onClick={initAudio}>
                    <div className="absolute top-10 left-10 w-32 h-32 bg-green-200 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob"></div>
                    <div className="absolute bottom-10 right-10 w-32 h-32 bg-yellow-200 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-2000"></div>

                    <div className="z-10 text-center mb-8 mt-4">
                        <h1 className="text-4xl md:text-5xl font-jua text-green-700 mb-2 drop-shadow-lg leading-tight">
                            ì¤€5ê¸‰<br className="sm:hidden" /> í•œì ë†€ì´í„°
                        </h1>
                        <p className="text-green-600 text-lg font-bold mt-2">ì¦ê²ê²Œ ë°°ìš°ëŠ” í•œì 62ì!</p>
                    </div>
                    
                    <div className="grid gap-4 w-full max-w-xs z-10 mb-12">
                        <button onClick={() => handleModeChange('list')} className="bg-teal-500 hover:bg-teal-600 text-white font-jua text-2xl py-4 rounded-2xl shadow-lg transition transform active:scale-95">
                            ğŸ“‹ ì „ì²´ í•œì ë³´ê¸°
                        </button>
                        <button onClick={() => handleModeChange('flashcard')} className="bg-yellow-400 hover:bg-yellow-500 text-white font-jua text-2xl py-4 rounded-2xl shadow-lg transition transform active:scale-95">
                            ğŸ“– ê³µë¶€í•˜ê¸°
                        </button>
                        <button onClick={() => handleModeChange('quiz')} className="bg-blue-400 hover:bg-blue-500 text-white font-jua text-2xl py-4 rounded-2xl shadow-lg transition transform active:scale-95">
                            ğŸ¯ í€´ì¦ˆ í’€ê¸°
                        </button>
                        <button onClick={() => handleModeChange('memory')} className="bg-pink-400 hover:bg-pink-500 text-white font-jua text-2xl py-4 rounded-2xl shadow-lg transition transform active:scale-95">
                            ğŸ§© ì§ ë§ì¶”ê¸°
                        </button>
                    </div>

                    {/* ì €ì‘ê¶Œ ë° ì¶œì²˜ í‘œì‹œ Footer */}
                    <div className="absolute bottom-4 text-center z-10 text-gray-500 text-xs sm:text-sm font-sans opacity-70 w-full px-4">
                        <p className="mb-1">
                            <span className="font-bold">Music by Suno</span> | <span>Font: ë°°ë‹¬ì˜ë¯¼ì¡± ì£¼ì•„, Noto Sans</span>
                        </p>
                        <p>
                            &copy; 2026 kiado-k. All rights reserved.
                        </p>
                    </div>
                </div>
            );
        };

        // ------------------------------------------------
        // ì „ì²´ í•œì ë³´ê¸°
        // ------------------------------------------------
        const HanjaListView = ({ onBack }) => {
            return (
                <div className="min-h-screen bg-teal-50 pb-20">
                    <div className="sticky top-0 bg-teal-100 shadow-md z-20 px-4 py-3 flex items-center justify-between">
                        <button 
                            onClick={() => { SoundManager.click(); onBack(); }} 
                            className="bg-white text-teal-700 px-4 py-2 rounded-lg font-bold shadow-sm active:scale-95 text-sm sm:text-base whitespace-nowrap"
                        >
                            â—€ ë’¤ë¡œ
                        </button>
                        <h2 className="text-xl sm:text-2xl font-jua text-teal-800 text-center flex-1 mx-2 truncate">
                            ì „ì²´ í•œì (62ì)
                        </h2>
                        <div className="w-16"></div>
                    </div>

                    <div className="max-w-6xl mx-auto p-4">
                        <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3">
                            {hanjaData.map((item) => (
                                <div key={item.id} className="bg-white p-3 rounded-xl shadow-sm border border-teal-100 flex flex-col items-center text-center">
                                    <span className={`font-bold text-gray-800 mb-1 whitespace-nowrap overflow-hidden ${getListHanjaSize(item.hanja)}`}>
                                        {item.hanja}
                                    </span>
                                    <span className="text-lg font-jua text-teal-600 leading-none mb-1">{item.hangul}</span>
                                    <span className="text-xs text-gray-500 leading-tight break-keep">{item.meaning}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // ------------------------------------------------
        // ê³µë¶€í•˜ê¸°
        // ------------------------------------------------
        const FlashcardGame = ({ onBack }) => {
            const [cards, setCards] = useState([]);
            const [index, setIndex] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);

            useEffect(() => {
                setCards(shuffle([...hanjaData]));
            }, []);

            const handleNext = () => {
                SoundManager.click();
                setIsFlipped(false);
                setTimeout(() => {
                    setIndex((prev) => (prev + 1) % cards.length);
                }, 150);
            };

            const handlePrev = () => {
                SoundManager.click();
                setIsFlipped(false);
                setTimeout(() => {
                    setIndex((prev) => (prev - 1 + cards.length) % cards.length);
                }, 150);
            };

            const handleCardClick = () => {
                SoundManager.flip();
                setIsFlipped(!isFlipped);
            };

            if (cards.length === 0) return <div>ë¡œë”©ì¤‘...</div>;
            
            const currentHanja = cards[index].hanja;

            return (
                <div className="flex flex-col items-center justify-center min-h-screen bg-yellow-50 p-4 pb-20">
                    <div className="w-full max-w-md flex justify-between items-center mb-6">
                        <button onClick={() => { SoundManager.click(); onBack(); }} className="text-gray-500 hover:text-gray-700 font-bold text-lg bg-white px-3 py-1 rounded-lg shadow-sm">
                            â—€ ë‚˜ê°€ê¸°
                        </button>
                        <span className="font-jua text-xl text-yellow-800 bg-yellow-200 px-3 py-1 rounded-full">{index + 1} / {cards.length}</span>
                    </div>

                    <div 
                        className={`relative w-full max-w-[300px] aspect-[3/4] cursor-pointer perspective-1000 ${isFlipped ? 'flipped' : ''}`}
                        onClick={handleCardClick}
                    >
                        <div className="card-inner w-full h-full relative">
                            <div className="card-front bg-white border-4 border-yellow-300 rounded-3xl flex flex-col items-center justify-center shadow-xl p-2">
                                <span className={`${getHanjaFontSize(currentHanja)} font-bold text-gray-800 mb-6 whitespace-nowrap overflow-hidden text-ellipsis px-2`}>
                                    {currentHanja}
                                </span>
                                <span className="text-gray-500 text-sm bg-gray-100 px-3 py-1 rounded-full animate-bounce">í„°ì¹˜í•˜ì—¬ ëœ» ë³´ê¸°</span>
                            </div>
                            <div className="card-back bg-yellow-300 border-4 border-yellow-400 rounded-3xl flex flex-col items-center justify-center shadow-xl p-4 text-center">
                                <span className="text-5xl font-jua text-white drop-shadow-md mb-4">{cards[index].hangul}</span>
                                <div className="bg-white/90 rounded-xl p-4 w-full shadow-inner">
                                    <span className="text-gray-800 font-bold block text-lg word-keep-all">{cards[index].meaning}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="flex gap-4 mt-8 w-full max-w-md justify-center">
                        <button onClick={handlePrev} className="bg-white border-2 border-gray-200 py-3 px-6 rounded-xl shadow-lg hover:bg-gray-50 active:scale-95 transition font-bold text-gray-600">
                            ì´ì „
                        </button>
                        <button onClick={handleNext} className="flex-1 bg-yellow-400 text-white font-jua text-xl py-3 px-6 rounded-xl shadow-lg hover:bg-yellow-500 active:scale-95 transition">
                            ë‹¤ìŒ ë‹¨ì–´ â–¶
                        </button>
                    </div>
                </div>
            );
        };

        // ------------------------------------------------
        // í€´ì¦ˆ ê²Œì„
        // ------------------------------------------------
        const QuizGame = ({ onBack }) => {
            const [gameState, setGameState] = useState('setup'); 
            const [totalQ, setTotalQ] = useState(10);
            const [questions, setQuestions] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [feedback, setFeedback] = useState(null); 
            const [timer, setTimer] = useState(0);
            const [shake, setShake] = useState(false);
            const timerRef = useRef(null);

            const handleStart = () => {
                SoundManager.click();
                const shuffled = shuffle([...hanjaData]);
                const selected = shuffled.slice(0, totalQ);
                
                const quizSet = selected.map(q => {
                    let distractors = [];
                    while (distractors.length < 3) {
                        const d = hanjaData[Math.floor(Math.random() * hanjaData.length)];
                        if (d.id !== q.id && !distractors.find(x => x.id === d.id)) {
                            distractors.push(d);
                        }
                    }
                    return {
                        question: q,
                        options: shuffle([q, ...distractors])
                    };
                });

                setQuestions(quizSet);
                setGameState('play');
                setScore(0);
                setCurrentIndex(0);
                setTimer(0);
                
                timerRef.current = setInterval(() => {
                    setTimer(t => t + 1);
                }, 1000);
            };

            const handleAnswer = (selectedOption) => {
                if (feedback) return;

                const currentQ = questions[currentIndex].question;
                if (selectedOption.id === currentQ.id) {
                    SoundManager.correct();
                    setScore(prev => prev + 1);
                    setFeedback('correct');
                } else {
                    SoundManager.wrong();
                    setFeedback('wrong');
                    setShake(true);
                    setTimeout(() => setShake(false), 500);
                }

                setTimeout(() => {
                    setFeedback(null);
                    if (currentIndex < totalQ - 1) {
                        setCurrentIndex(prev => prev + 1);
                    } else {
                        clearInterval(timerRef.current);
                        SoundManager.win();
                        setGameState('result');
                    }
                }, 1000);
            };

            if (gameState === 'setup') {
                return (
                    <div className="flex flex-col items-center justify-center min-h-screen bg-blue-50 p-4">
                        <div className="bg-white p-6 rounded-3xl shadow-xl w-full max-w-sm text-center">
                            <h2 className="text-3xl font-jua text-blue-600 mb-6">í€´ì¦ˆ ì„¤ì •</h2>
                            <label className="block text-gray-700 mb-2 font-bold">ë¬¸ì œ ê°œìˆ˜ (1 ~ 62)</label>
                            <input 
                                type="number" 
                                value={totalQ}
                                onChange={(e) => {
                                    let val = parseInt(e.target.value);
                                    if(isNaN(val)) val = "";
                                    else if(val > 62) val = 62;
                                    else if(val < 1) val = 1;
                                    setTotalQ(val);
                                }}
                                className="w-full text-center text-3xl border-2 border-blue-200 rounded-xl p-3 mb-6 focus:outline-none focus:border-blue-500"
                            />
                            <div className="flex gap-2">
                                <button onClick={() => { SoundManager.click(); onBack(); }} className="flex-1 bg-gray-200 text-gray-600 font-jua py-3 rounded-xl hover:bg-gray-300">ì·¨ì†Œ</button>
                                <button onClick={handleStart} className="flex-1 bg-blue-500 text-white font-jua py-3 rounded-xl hover:bg-blue-600 shadow-md">ì‹œì‘!</button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (gameState === 'result') {
                return (
                    <div className="flex flex-col items-center justify-center min-h-screen bg-blue-50 p-4">
                        <div className="bg-white p-8 rounded-3xl shadow-xl w-full max-w-sm text-center pop-animation">
                            <h2 className="text-4xl font-jua text-blue-600 mb-6">ê²°ê³¼ ë°œí‘œ!</h2>
                            <div className="space-y-4 mb-8 text-lg">
                                <div className="flex justify-between border-b pb-2">
                                    <span className="text-gray-500">ì´ ë¬¸ì œ</span>
                                    <span className="font-bold text-gray-800">{totalQ}ê°œ</span>
                                </div>
                                <div className="flex justify-between border-b pb-2">
                                    <span className="text-green-600 font-bold">ì •ë‹µ</span>
                                    <span className="font-bold text-green-600">{score}ê°œ</span>
                                </div>
                                <div className="flex justify-between border-b pb-2">
                                    <span className="text-red-500 font-bold">ì˜¤ë‹µ</span>
                                    <span className="font-bold text-red-500">{totalQ - score}ê°œ</span>
                                </div>
                                <div className="flex justify-between border-b pb-2">
                                    <span className="text-blue-600 font-bold">ì •ë‹µë¥ </span>
                                    <span className="font-bold text-blue-600">{Math.round((score/totalQ)*100)}%</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-gray-500">ì†Œìš” ì‹œê°„</span>
                                    <span className="font-bold">{formatTime(timer)}</span>
                                </div>
                            </div>
                            <button onClick={() => { SoundManager.click(); setGameState('setup'); }} className="w-full bg-blue-500 text-white font-jua py-4 rounded-xl text-xl shadow-lg hover:bg-blue-600">
                                ë‹¤ì‹œ í•˜ê¸°
                            </button>
                            <button onClick={() => { SoundManager.click(); onBack(); }} className="mt-4 text-gray-500 hover:text-gray-700 underline">
                                ë©”ì¸ìœ¼ë¡œ
                            </button>
                        </div>
                    </div>
                );
            }

            const currentData = questions[currentIndex];
            const currentHanja = currentData.question.hanja;

            return (
                <div className="flex flex-col items-center justify-center min-h-screen bg-blue-50 p-4 pb-20">
                    <div className="w-full max-w-md flex justify-between items-center mb-4">
                        <button onClick={() => { clearInterval(timerRef.current); SoundManager.click(); onBack(); }} className="text-gray-500 font-bold bg-white px-3 py-1 rounded-lg">â—€ ì¢…ë£Œ</button>
                        <div className="font-mono text-lg bg-white px-3 py-1 rounded-lg shadow text-blue-600">
                            â±ï¸ {formatTime(timer)}
                        </div>
                    </div>

                    <div className="w-full max-w-md mb-2 px-1">
                        <span className="text-blue-800 font-bold text-lg">ë¬¸ì œ {currentIndex + 1} / {totalQ}</span>
                    </div>

                    <div className={`bg-white p-6 rounded-3xl shadow-xl w-full max-w-md text-center mb-4 relative border-4 border-blue-100 min-h-[200px] flex flex-col justify-center items-center ${shake ? 'shake-animation' : ''}`}>
                        <h2 className="text-gray-400 text-sm absolute top-4">ë‹¤ìŒ í•œìì˜ í›ˆê³¼ ìŒì€?</h2>
                        <div className={`${getHanjaFontSize(currentHanja)} font-bold text-gray-800 mt-4 whitespace-nowrap overflow-hidden text-ellipsis w-full px-2`}>
                            {currentHanja}
                        </div>
                        
                        {feedback === 'correct' && (
                            <div className="absolute inset-0 flex items-center justify-center bg-green-100/90 rounded-2xl pop-animation z-10">
                                <span className="text-8xl">â­•</span>
                            </div>
                        )}
                        {feedback === 'wrong' && (
                            <div className="absolute inset-0 flex items-center justify-center bg-red-100/90 rounded-2xl pop-animation z-10">
                                <div className="text-center">
                                    <span className="text-7xl block mb-2">âŒ</span>
                                    <span className="text-xl font-bold text-red-600">{currentData.question.hangul}</span>
                                </div>
                            </div>
                        )}
                    </div>

                    <div className="grid grid-cols-2 gap-3 w-full max-w-md">
                        {currentData.options.map((opt, idx) => (
                            <button
                                key={idx}
                                onClick={() => handleAnswer(opt)}
                                disabled={!!feedback}
                                className={`
                                    py-3 px-2 rounded-xl font-jua text-xl shadow-md transition transform active:scale-95 flex flex-col items-center justify-center h-20
                                    ${feedback && opt.id === currentData.question.id ? 'bg-green-500 text-white' : 'bg-white hover:bg-blue-50 text-gray-700'}
                                    ${feedback === 'wrong' && opt.id !== currentData.question.id ? 'opacity-50' : ''}
                                `}
                            >
                                <span className="text-lg sm:text-xl mb-1">{opt.hangul}</span>
                                <span className="text-xs font-sans font-normal opacity-70 line-clamp-1">{opt.meaning}</span>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // ------------------------------------------------
        // ì§ ë§ì¶”ê¸°
        // ------------------------------------------------
        const MemoryGame = ({ onBack }) => {
            const [gameState, setGameState] = useState('setup');
            const [pairCount, setPairCount] = useState(6);
            const [cards, setCards] = useState([]);
            const [flipped, setFlipped] = useState([]);
            const [matched, setMatched] = useState([]);
            const [isLocked, setIsLocked] = useState(false);
            const [timer, setTimer] = useState(0);
            const timerRef = useRef(null);

            const handleStart = () => {
                SoundManager.click();
                const selected = shuffle([...hanjaData]).slice(0, pairCount);
                const deck = [];
                selected.forEach((item) => {
                    deck.push({ id: item.id, content: item.hanja, type: 'hanja', pairId: item.id });
                    deck.push({ id: item.id, content: item.hangul, type: 'hangul', pairId: item.id });
                });
                
                const shuffledDeck = shuffle(deck).map((card, idx) => ({ ...card, uniqueId: idx }));
                setCards(shuffledDeck);
                setFlipped([]);
                setMatched([]);
                setIsLocked(false);
                setGameState('play');
                setTimer(0);

                timerRef.current = setInterval(() => {
                    setTimer(t => t + 1);
                }, 1000);
            };

            const handleCardClick = (index) => {
                if (isLocked) return;
                if (flipped.includes(index)) return;
                if (matched.includes(cards[index].pairId)) return;

                SoundManager.flip();
                const newFlipped = [...flipped, index];
                setFlipped(newFlipped);

                if (newFlipped.length === 2) {
                    setIsLocked(true);
                    const firstCard = cards[newFlipped[0]];
                    const secondCard = cards[newFlipped[1]];

                    if (firstCard.pairId === secondCard.pairId) {
                        setTimeout(() => SoundManager.correct(), 300);
                        const newMatched = [...matched, firstCard.pairId];
                        setMatched(newMatched);
                        setFlipped([]);
                        setIsLocked(false);

                        if (newMatched.length === pairCount) {
                            clearInterval(timerRef.current);
                            SoundManager.win();
                            setTimeout(() => setGameState('result'), 500);
                        }
                    } else {
                        setTimeout(() => SoundManager.wrong(), 500);
                        setTimeout(() => {
                            setFlipped([]);
                            setIsLocked(false);
                        }, 1000);
                    }
                }
            };

            if (gameState === 'setup') {
                return (
                    <div className="flex flex-col items-center justify-center min-h-screen bg-pink-50 p-4">
                        <div className="bg-white p-6 rounded-3xl shadow-xl w-full max-w-sm text-center">
                            <h2 className="text-3xl font-jua text-pink-600 mb-6">ì§ ë§ì¶”ê¸° ì„¤ì •</h2>
                            <label className="block text-gray-700 mb-2 font-bold">ë§ì¶œ ì§ ê°œìˆ˜ (1 ~ 62)</label>
                            <input 
                                type="number" 
                                value={pairCount}
                                onChange={(e) => {
                                    let val = parseInt(e.target.value);
                                    if(isNaN(val)) val = "";
                                    else if(val > 62) val = 62;
                                    else if(val < 1) val = 1;
                                    setPairCount(val);
                                }}
                                className="w-full text-center text-3xl border-2 border-pink-200 rounded-xl p-3 mb-6 focus:outline-none focus:border-pink-500"
                            />
                            <div className="flex gap-2">
                                <button onClick={() => { SoundManager.click(); onBack(); }} className="flex-1 bg-gray-200 text-gray-600 font-jua py-3 rounded-xl hover:bg-gray-300">ì·¨ì†Œ</button>
                                <button onClick={handleStart} className="flex-1 bg-pink-500 text-white font-jua py-3 rounded-xl hover:bg-pink-600 shadow-md">ì‹œì‘!</button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (gameState === 'result') {
                return (
                    <div className="flex flex-col items-center justify-center min-h-screen bg-pink-50 p-4">
                        <div className="bg-white p-8 rounded-3xl shadow-xl w-full max-w-sm text-center pop-animation">
                            <div className="text-8xl mb-4">ğŸ‰</div>
                            <h2 className="text-4xl font-jua text-pink-600 mb-6">ì„±ê³µ!</h2>
                            <div className="bg-pink-50 p-4 rounded-xl mb-6">
                                <p className="text-gray-600">ì†Œìš” ì‹œê°„</p>
                                <p className="text-3xl font-bold text-pink-700">{formatTime(timer)}</p>
                            </div>
                            <button onClick={() => { SoundManager.click(); setGameState('setup'); }} className="w-full bg-pink-500 text-white font-jua py-4 rounded-xl shadow-lg hover:bg-pink-600 mb-2">
                                ë‹¤ì‹œ í•˜ê¸°
                            </button>
                            <button onClick={() => { SoundManager.click(); onBack(); }} className="text-gray-500 hover:text-gray-700 underline">
                                ë©”ì¸ìœ¼ë¡œ
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="flex flex-col items-center justify-center min-h-screen bg-pink-50 p-2 pb-20">
                    <div className="w-full max-w-3xl flex justify-between items-center mb-4 px-2">
                        <button onClick={() => { clearInterval(timerRef.current); SoundManager.click(); onBack(); }} className="text-gray-500 font-bold bg-white px-3 py-1 rounded-lg">â—€ ì¢…ë£Œ</button>
                        <div className="flex gap-3 items-center">
                            <span className="font-jua text-pink-600 text-sm sm:text-base">ë‚¨ì€ ì§: {pairCount - matched.length}</span>
                            <div className="font-mono bg-white px-2 py-1 rounded shadow text-pink-600 text-sm">
                                {formatTime(timer)}
                            </div>
                        </div>
                    </div>

                    <div className={`grid gap-2 w-full max-w-3xl ${pairCount > 12 ? 'grid-cols-4 sm:grid-cols-6' : 'grid-cols-3 sm:grid-cols-4'}`}>
                        {cards.map((card, idx) => {
                            const isFlippedCard = flipped.includes(idx) || matched.includes(card.pairId);
                            const isMatchedCard = matched.includes(card.pairId);
                            
                            let textSize;
                            if (card.type === 'hanja') {
                                if (card.content.length >= 3) textSize = pairCount > 15 ? 'text-xs sm:text-sm' : 'text-base sm:text-lg';
                                else textSize = pairCount > 15 ? 'text-lg sm:text-xl' : 'text-2xl sm:text-3xl';
                            } else {
                                textSize = pairCount > 15 ? 'text-xs sm:text-sm' : 'text-base sm:text-xl';
                            }
                            
                            return (
                                <div 
                                    key={card.uniqueId}
                                    onClick={() => handleCardClick(idx)}
                                    className={`
                                        aspect-square rounded-lg flex items-center justify-center text-center cursor-pointer shadow-md transition-all duration-300 overflow-hidden
                                        ${isFlippedCard ? 'bg-white rotate-y-180' : 'bg-pink-300'}
                                        ${isMatchedCard ? 'opacity-20 scale-90' : ''}
                                    `}
                                >
                                    {isFlippedCard ? (
                                        <span className={`font-bold whitespace-nowrap px-1 ${textSize} ${card.type === 'hanja' ? 'text-gray-800' : 'font-jua text-pink-600'}`}>
                                            {card.content}
                                        </span>
                                    ) : (
                                        <span className="text-xl opacity-50">â“</span>
                                    )}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [mode, setMode] = useState('menu'); 

            useEffect(() => {
                const enableAudio = () => {
                    initAudio();
                };
                window.addEventListener('click', enableAudio, { once: true });
                window.addEventListener('touchstart', enableAudio, { once: true });
                return () => {
                    window.removeEventListener('click', enableAudio);
                    window.removeEventListener('touchstart', enableAudio);
                };
            }, []);

            return (
                <React.Fragment>
                    <BGMPlayer mode={mode} />
                    {mode === 'menu' && <MainMenu setMode={setMode} />}
                    {mode === 'list' && <HanjaListView onBack={() => setMode('menu')} />}
                    {mode === 'flashcard' && <FlashcardGame onBack={() => setMode('menu')} />}
                    {mode === 'quiz' && <QuizGame onBack={() => setMode('menu')} />}
                    {mode === 'memory' && <MemoryGame onBack={() => setMode('menu')} />}
                </React.Fragment>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
